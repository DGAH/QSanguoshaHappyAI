--[[	新版太阳神三国杀MOD之欢乐AI系统（独孤安河实验版）樊城之战模式部分]]--sgs.ai_role_to_camp["fancheng"] = {	lord = "loyal",	loyalist = "loyal",	renegade = "renegade",	rebel = "rebel"}sgs.InitRelationship["fancheng"] = function()	local lord = global_room:getLord()	local lordname = lord:objectName()	table.insert(sgs.ai_lords, lordname)	local allplayers = global_room:getAllPlayers()	for _,p in sgs.qlist(allplayers) do		local nameA = p:objectName()		local campA = sgs.ai_camp[nameA]		if campA == "loyal" then			sgs.ai_lord[nameA] = lordname		end		for _,p2 in sgs.qlist(allplayers) do			local nameB = p2:objectName()			local campB = sgs.ai_camp[nameB]			if campA == campB then				sgs.ai_relationship[nameA][nameB] = "partner"			else				sgs.ai_relationship[nameA][nameB] = "opponent"			end		end	endend--[[	技能：支援	描述：出牌阶段，曹仁给一张基本牌给徐晃或SP庞德，每回合限用两次]]----[[	内容：注册“支援技能卡”]]--sgs.RegistCard("ZhiyuanCard")--[[	内容：“支援”技能信息]]--sgs.ai_skills["zhiyuan"] = {	name = "zhiyuan",	dummyCard = function(self)		return sgs.Card_Parse("@ZhiyuanCard=.")	end,	enabled = function(self, handcards)		if self.player:getMark("zhiyuan") > 0 then			for _,basic in ipairs(handcards) do				if basic:isKindOf("BasicCard") then					return true				end			end		end		return false	end,}--[[	内容：“支援技能卡”的具体使用方式]]--sgs.ai_skill_use_func["ZhiyuanCard"] = function(self, card, use)	local cards = self.player:getCards("h")	local basics = {}	for _,basic in sgs.qlist(cards) do		if basic:isKindOf("BasicCard") then			table.insert(basics, basic)		end	end	if #basics > 0 then		self:sortByUseValue(basics)		local basic = nil		for _,c in ipairs(basics) do			if c:isKindOf("Slash") then				if self:getCardsNum("Slash") > 1 then					basic = c					break				end			elseif c:isKindOf("Jink") then				if self:getCardsNum("Jink") > 1 then					basic = c					break				end			elseif c:isKindOf("Peach") then				if self.player:getHp() > 2 then					basic = c					break				end			else				basic = c				break			end		end		if basic then			local card_str = "@ZhiyuanCard=" .. basic:getEffectiveId()			self:sort(self.friends_noself, "handcard")			for _,friend in ipairs(self.friends_noself) do				use.card = sgs.Card_Parse(card_str)				if use.to then					use.to:append(friend)				end				return			end		end	endend--[[	套路：仅使用“支援技能卡”]]--sgs.ai_series["ZhiyuanCardOnly"] = {	name = "ZhiyuanCardOnly",	IQ = 2,	value = 2,	priority = 4,	cards = {		["ZhiyuanCard"] = 1,		["Others"] = 1,	},	enabled = function(self)		return true	end,	action = function(self, handcards, skillcards)		local zhiyuan_skill = sgs.ai_skills["zhiyuan"]		local dummyCard = zhiyuan_skill["dummyCard"](self)		return {dummyCard}	end,	break_condition = function(self)		return false	end,}table.insert(sgs.ai_card_actions["ZhiyuanCard"], "ZhiyuanCardOnly")--[[	技能：抬榇战关羽	描述：出牌阶段，SP庞德可自减1点体力，视作对关羽打出了一张决斗，此决斗不能被无懈可击且在决斗过程中SP庞德视为有无双技能，每回合限一次。]]----[[	内容：注册“抬榇战技能卡”]]--sgs.RegistCard("TaichenFightCard")--[[	内容：“抬榇战关羽”技能信息]]--sgs.ai_skills["taichenfight"] = {	name = "taichenfight",	dummyCard = function(self)		return sgs.Card_Parse("@TaichenFightCard=.")	end,	enabled = function(self, handcards)		if self.player:hasUsed("TaichenFightCard") then			return false		end		return true	end,}--[[	内容：“抬榇战技能卡”的具体使用方式]]--sgs.ai_skill_use_func["TaichenFightCard"] = function(self, card, use)	local GuanYu = self.room:getLord()	if GuanYu then		if GuanYu:getHp() < self.player:getHp() then			local my_slash_count = self:getCardsNum("Slash")			local slash_count = sgs.getCardsNum("Slash", GuanYu)			if (my_slash_count + 1) * 2 > slash_count then				use.card = card			end		end	endend--[[	套路：仅使用“抬榇战技能卡”]]--sgs.ai_series["TaichenFightCardOnly"] = {	name = "TaichenFightCardOnly",	IQ = 2,	value = 2,	priority = 3,	cards = {		["TaichenFightCard"] = 1,		["Others"] = 0,	},	enabled = function(self)		return true	end,	action = function(self, handcards, skillcards)		local fight_skill = sgs.ai_skills["taichenfight"]		local dummyCard = fight_skill["dummyCard"](self)		return {dummyCard}	end,	break_condition = function(self)		return false	end,}table.insert(sgs.ai_card_actions["TaichenFightCard"], "TaichenFightCardOnly")--[[	技能：水淹七军（限定技）	描述：关羽可弃3张黑色手牌，令所有反贼弃掉所有装备，并弃2张手牌或受到关羽的1点伤害，弃手牌还是装备由反贼决定，若手牌不足两张则必须受到伤害（与刚烈成功一样），曹仁的手牌上限-1。]]----[[	内容：注册“水淹技能卡”]]--sgs.RegistCard("FloodCard")--[[	内容：“水淹七军”技能信息]]--sgs.ai_skills["flood"] = {	name = "flood",	dummyCard = function(self)		return sgs.Card_Parse("@FloodCard=.")	end,	enabled = function(self, handcards)		if self.player:getMark("flood") == 0 then			local count = 0			for _,black in ipairs(handcards) do				if black:isBlack() then					count = count + 1				end			end			return count >= 3		end		return false	end,}--[[	内容：“水淹技能卡”的具体使用方式]]--sgs.ai_skill_use_func["FloodCard"] = function(self, card, use)	local cards = self.player:getHandcards()	local blacks = {}	for _,black in sgs.qlist(cards) do		if black:isBlack() then			table.insert(blacks, black)		end	end	if #blacks >= 3 then		self:sortByUseValue(blacks, true)		local to_use = {}		for index, black in ipairs(blacks) do			if index > 3 then				break			else				table.insert(to_use, black:getEffectiveId())			end		end		local card_str = "@FloodCard=" .. table.concat(blacks, "+")		local others = self.room:getOtherPlayers(self.player)		local value = 0		for _,enemy in sgs.qlist(others) do			if self:mayRebel(enemy) then				local equips = enemy:getEquips()				value = value + equips:length()				if enemy:getHandcardNum() <= 2 then					value = value + 2				elseif enemy:getHp() < 2 then					value = value + 2				end			end		end		if value > 3 then			use.card = sgs.Card_Parse(card_str)		end	endend--[[	套路：仅使用“水淹技能卡”]]--sgs.ai_series["FloodCardOnly"] = {	name = "FloodCardOnly",	IQ = 2,	value = 3.5,	priority = 3,	cards = {		["FloodCard"] = 1,		["Others"] = 0,	},	enabled = function(self)		return true	end,	action = function(self, handcards, skillcards)		local flood_skill = sgs.ai_skills["flood"]		local dummyCard = flood_skill["dummyCard"](self)		return {dummyCard}	end,	break_condition = function(self)		return false	end,}table.insert(sgs.ai_card_actions["FloodCard"], "FloodCardOnly")--[[	技能：刮骨疗毒（锁定技）	描述：华佗每对关羽造成1点伤害，关羽回复2点体力，且华佗再摸一张牌]]----[[	技能：白衣渡江（限定技）	描述：在吕蒙的回合开始阶段，他可弃掉2张已装备的装备，变身为神吕蒙，体力上限变为3（若当前体力值为4，则同样降到3），失去原来的克己技能，同时获得神吕蒙的涉猎与攻心的技能。]]--sgs.ai_skill_use["@@dujiang"] = function(self, prompt, method)	local equips = self.player:getEquips()	if equips:length() >= 2 then		local cardA = equips:first()		local cardB = equips:at(1)		local card_str = "@DujiangCard="..cardA:getId().."+"..cardB:getId().."->."		return card_str	end	return "."end--[[	技能：玉泉显圣（限定技）	描述：在关羽回合开始阶段，若体力小于等于2，则可以弃掉所有装备和手牌，然后摸3张手牌，变身为神关羽（没有武魂的索命技能，仅有武神），体力和体力上限皆为6。]]--sgs.ai_skill_invoke["xiansheng"] = function(self, data)	local enemyCount = #self.opponents 	local equips = self.player:getEquips()	local num = self.player:getHandcardNum()	local len = equips:length()	if enemyCount * 2 + 3 > num + 2 * len then		return true	end	if num <= 1 then		local hp = self.player:getHp()		if hp == 1 then			return true		end	end	return falseend